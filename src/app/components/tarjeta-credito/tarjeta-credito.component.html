<div class="container-fluid">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-8">
      <div class="card">
        <div class="card-body">
          <h2 class="titulo text-center">üí≥ TARJETA CR√âDITO</h2>
        </div>
      </div>
    </div>
  </div>

  <div class="row mt-4 justify-content-center">
    <div class="col-12 col-lg-6 d-flex flex-column align-items-center">

      <!-- AGREGAR / EDITAR TARJETA -->
      <div class="card w-100 mb-2 shadow-sm">
        <div class="card-body">
          <h5 class="titulo text-center">
            {{ editIndex !== null ? '‚úèÔ∏è EDITAR TARJETA' : '‚ûï AGREGAR TARJETA' }}
          </h5>

          <form [formGroup]="tarjetaForm" (ngSubmit)="agregarTarjeta()">

            <!-- Titular -->
            <div class="input-group mb-3">
              <span class="input-group-text"><i class="fa-solid fa-user"></i></span>
              <input type="text" class="form-control" placeholder="Titular" formControlName="titular">
            </div>
            <div *ngIf="tarjetaForm.get('titular')?.invalid && tarjetaForm.get('titular')?.touched"
              class="text-danger mb-2">
              ‚ö†Ô∏è El titular es obligatorio.
            </div>

            <!-- N√∫mero -->
            <div class="input-group mb-3">
              <span class="input-group-text"><i class="fa-solid fa-credit-card"></i></span>
              <input type="text" maxlength="16" class="form-control" placeholder="N√∫mero (16 d√≠gitos)"
                formControlName="numero">
            </div>
            <div *ngIf="tarjetaForm.get('numero')?.invalid && tarjetaForm.get('numero')?.touched"
              class="text-danger mb-2">
              ‚ö†Ô∏è Ingres√° un n√∫mero v√°lido de 16 d√≠gitos.
            </div>

            <div class="d-flex mb-3 gap-2">
              <!-- Fecha de expiraci√≥n -->
<div class="flex-fill">
  <div class="input-group">
    <span class="input-group-text"><i class="fa-solid fa-calendar"></i></span>
    <input 
      class="form-control" 
      placeholder="MM/AA"
      formControlName="fechadeexpiracion"
      (input)="autoFormatFecha($event)">
  </div>
  <div *ngIf="tarjetaForm.get('fechadeexpiracion')?.invalid && tarjetaForm.get('fechadeexpiracion')?.touched" class="text-danger">
     Seleccion√° una fecha v√°lida.
  </div>
</div>



              <!-- CVV -->
              <div class="flex-fill">
                <div class="input-group">
                  <span class="input-group-text"><i class="fa-solid fa-lock"></i></span>
                  <input type="text" maxlength="3" class="form-control" placeholder="CVV" formControlName="cvv">
                </div>
                <div *ngIf="tarjetaForm.get('cvv')?.invalid && tarjetaForm.get('cvv')?.touched" class="text-danger">
                   CVV de 3 d√≠gitos.
                </div>
              </div>
            </div>

            <!-- Bot√≥n Submit -->
            <button type="submit" class="btn btn-primary w-100" [disabled]="tarjetaForm.invalid">
              <i class="fa-solid" [ngClass]="editIndex !== null ? 'fa-save' : 'fa-plus'"></i>
              {{ editIndex !== null ? 'Guardar Cambios' : 'Agregar Tarjeta' }}
            </button>
          </form>
        </div>
      </div>

      <!-- LISTADO DE TARJETAS -->
      <div class="card w-100 shadow-sm">
        <div class="card-body">
          <h5 class="titulo text-center">üìã LISTADO DE TARJETAS</h5>
          <table class="table table-striped align-middle">
            <thead>
              <tr>
                <th>Titular</th>
                <th>N√∫mero</th>
                <th>Vencimiento</th>
                <th class="text-center">Editar</th>
                <th class="text-center">Eliminar</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let tarjeta of listTarjetas; let i = index">
                <td>{{ tarjeta.titular }}</td>
                <td>{{ tarjeta.numero }}</td>
                <td>{{ mostrarFecha(tarjeta) }}</td>
                <td class="text-center">
                  <i class="fa-solid fa-pen-to-square text-info" style="cursor:pointer" (click)="editarTarjeta(i)"></i>
                </td>
                <td class="text-center">
                  <i class="fa-solid fa-trash text-danger" style="cursor:pointer" (click)="eliminarTarjeta(i)"></i>
                </td>
              </tr>
              <tr *ngIf="listTarjetas.length === 0">
                <td colspan="5" class="text-center text-muted">No hay tarjetas registradas.</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

    </div>
  </div>
</div>
